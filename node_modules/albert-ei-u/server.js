import express, { response } from 'express';
import mongoose, { Schema } from 'mongoose';
import {serverOn } from 'calculator-api-express';
import cors from 'cors';
import dotenv from 'dotenv';

dotenv.config();
serverOn(6753);

const app = express();
const PORT = process.env.PORT || 5000

app.use(cors());
app.use(express.json());

mongoose
        .connect(process.env.MONGO_URI)
        .then(()=>console.log("mongodb connected!"))
        .catch((err)=>console.error(err))

//Schema

const studentSchema = new mongoose.Schema({
    name:String,
    age:Number,
    email:String,
});

const Student = mongoose.model("Student", studentSchema);
//routes

app.post("/api/students", async (req, res)=> {
    try{
        const {name, age, email} = req.body
        const student = new Student({name, age, email});
        
        await student.save();

        res.status(201).json(student);
    }
    catch(err){
        res.status(500).json({error: err.message})
    }
});

app.get("/api/students", async (req, res)=>{
    try{
        const students = await Student.find();

        res.json(students);
    }
    catch(err){
        res.status(500).json({error: err.message})
    }
});

app.listen(PORT, ()=> console.log(`server running on port ${PORT}`));